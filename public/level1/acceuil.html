<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter 1</title>
  <link rel="stylesheet" href="style_levels.css" />
  <style>
    .status {
      font-weight: bold;
      margin-left: 8px;
    }
    .completed {
      color: green;
    }
    .in-progress {
      color: orange;
    }
  </style>
</head>

<body>
  <div class="title">
    <h1>CHAPTER 1</h1>
  </div>
  <div class="container">
    <h2>Story</h2>
    <p style="text-align: justify;">
      In the year 2132, an inhabited planet was discovered at the edge of the galaxy and named Algorea. Ten years later,
      you are sent on a mission around this planet with the goal of establishing the very first contact with its
      inhabitants. Unfortunately, comet Hal collided with your spaceship as you approached Algorea. You were forced to
      make an emergency ejection in a rescue capsule. You land on the planet with only a maintenance robot as your
      companion.
      Isolated on this distant world, you will meet its inhabitants, discover their customs, and build relationships to
      start a peaceful connection while waiting for the next mission to retrieve you. To achieve this, you will make use
      of your robot’s abilities! The robot comes with a manual that will be very useful during your journey. This robot
      can print text, display characters on a screen, move around, and manipulate objects.
      You notice that the manual suggests controlling the robot using several programming languages by writing code on a
      keyboard. Once you’ve made your choice, you head toward a site that appears to harbor life.
    </p>

    <h2>Objective of Chapter 1</h2>
    <p>You will display text and execute successive operations.</p>
    <hr>
    <p>
      To complete this chapter, solve at least all exercises labeled
      <span class="badge validation">Validation</span>.
    </p>

    <ul class="chapter-list">
      <li><span class="badge decouverte">Introduction</span><a href="Hello_World/Hello_World_Sujet.html?id=1">Hello
          world!</a></li>
      <li><span class="badge cours">Lesson</span> <a href="Hello_World/Hello_World_Sujet.html?id=2">Output
          representation of a program</a></li>
      <li><span class="badge entrainement">Practice</span> <a href="Hello_World/Hello_World_Sujet.html?id=3">2) Presentation</a></li>
      <li><span class="badge cours">Lesson</span> <a href="#">Displaying text: possible errors</a></li>
      <li><span class="badge decouverte">Introduction</span> <a href="Hello_World/Hello_World_Sujet.html?id=4">3)
          Mountain plan</a></li>
      <li><span class="badge validation">Validation</span> <a href="#">4) In the thicket</a></li>
      <li><span class="badge cours">Lesson</span> <a href="#">Movements: module necessity</a></li>
      <li><span class="badge challenge">Challenge</span> <a href="#">5) Cylinder stacking</a></li>
      <li><span class="badge cours">Lesson</span> <a href="#">Submissions, tips, and support forum</a></li>
      <li><span class="badge challenge">Challenge</span> <a href="#">6) Secret recipe</a></li>
    </ul>

    <div class="footer">
      <a href="#">⬆️</a>
      <a href="#" class="back-link">Back to chapter list</a>
      <a href="#">➡️</a>
    </div>
  </div>

  <script>
    async function loadProgress() {
      const username = localStorage.getItem("username"); // ✅ use username
      if (!username) {
        console.warn("⚠️ No user logged in");
        return;
      }

      try {
        const res = await fetch(`/api/progress/${username}`);
        const progress = await res.json();

        const statusMap = {};
        progress.forEach(row => {
          statusMap[row.exercise_id] = row.status;
        });

        document.querySelectorAll('.chapter-list a').forEach(link => {
          const params = new URLSearchParams(link.href.split('?')[1]);
          const exerciseId = params.get('id');
          if (exerciseId && statusMap[exerciseId]) {
            const statusSpan = document.createElement('span');
            statusSpan.classList.add('status');
            if (statusMap[exerciseId] === 'completed') {
              statusSpan.textContent = "✅ Completed";
              statusSpan.classList.add('completed');
            } else {
              statusSpan.textContent = "⏳ In Progress";
              statusSpan.classList.add('in-progress');
            }
            link.parentNode.appendChild(statusSpan);
          }
        });
      } catch (error) {
        console.error("❌ Error loading progress:", error);
      }
    }

    window.onload = loadProgress;
  </script>

</body>
</html>
